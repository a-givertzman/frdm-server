# Расчет координат блоков на кране

**Цель** - рассчитать глобальные координаты центров блоков, установленных на стреле крана. Расчет основан на длине и угле наклона каждой стрелы, а также на локальных координатах блоков относительно начала стрел.

Схема крана включает в себя:

- **Две стрелы:**
  - `main boom` — основная стрела, длина обозначается: $L_{boom(1)}$
  - `knuckle boom` — складная стрела, длина обозначается $L_{boom(2)}$
- **Шесть блоков:**
  - 1 блок — барабан лебедки, который стоит отдельно от стрел и его координаты будут определяться отдельно
  - 2-6 блоки — блоки на стрелах

![Alt text to image](/assets/algorithm/Crane1.png)

**Расчет подразделяется на следующие этапы:**  
1. Расчёт абсолютного угла наклона каждой стрелы
2. Определение начальной точки и конечной точки для каждой стрелы
3. Определение координаты точек блоков
4. Определение точек схода каната
5. Реализация (Пример)

## 1. Расчёт абсолютного угла наклона каждой стрелы

Поскольку каждая следующая стрела (звено) поворачивается относительно предыдущей, её ориентация в глобальной системе координат зависит от **накопленной суммы всех предыдущих углов**.

Исходные данные:  
$$\alpha = [\alpha_1, \alpha_2, \ldots, \alpha_n]$$ — массив углов между стрелами (в градусах), а для первой стрелы между стрелой и горизонтом

Эти углы снимаются с датчика и определяют, насколько повёрнута каждая стрела **относительно предыдущей**.  
  Например:
  - $\alpha_1$ — угол основной стрелы к горизонту,
  - $\alpha_2$ — угол второй стрелы относительно первой и т.д.

![Alt text to image](/assets/algorithm/angles.png)

### Формула для абсолютного угла наклона стрелы к горизонту:

$$
\alpha_{boom_i} = \left( \sum_{i=1}^{n} \alpha_{i} \right) - 180 \cdot (i - 1)
$$

Где:
- $i$ — номер стрелы (1, 2, ...),
- $\alpha_i$ — угол между $i$-й стрелой и предыдущей (в градусах), для первой между стрелой и горизонтом.
- $\alpha_{boom_i}$ — угол $i$-й стрелы относительно горизонта.

## Общие формулы, необходимые для расчета в общем виде

**1. Формула определения координат точки в повернутой системе координат**

Если повернутая система координат повёрнута **против часовой стрелки**, то угол берётся со знаком **плюс (+)**.   Если **по часовой стрелке** — со знаком **минус (−)**.

Формулы представленные ниже - являются формулой в общем виде, и она будет использоваться в расчетах далее.

$$
X_x(X_{x1}, Y_{x1}, \alpha_{boom_i}) = X_{x1} \cdot \cos(\alpha_{boom_i}) - Y_{x1} \cdot \sin(\alpha_{boom_i})  
$$
  
$$
Y_x(X_{x1}, Y_{x1}, \alpha_{boom_i}) = X_{x1} \cdot \sin(\alpha_{boom_i}) + Y_{x1} \cdot \cos(\alpha_{boom_i})
$$

$$
XY_x =
\begin{bmatrix}
X_x \\
Y_x
\end{bmatrix}
$$

Где 
- $X_{x1}, Y_{x1}$ - координаты в неповернутой СК 
- $\alpha_{boom_i}$ - абсолютный угол между i-стрелой и горизонтом  
- $X_x, Y_x$ - координаты в повернутой СК  
- $XY_x$ - переменная с координатами точки $x$ в повернутой СК  

**2. Угол наклона прямой к горизонту**

$$
a = asin(\frac{Y_1 - Y_2}{\sqrt{(X_2 - X_1)^2 + (Y_2 - Y_1)^2}})$$

- $if \quad X_1 <= X_2$
  
$$\alpha_{horiz}(Y_1, Y_2, X_1, X_2) = a$$

- $else:$ 

$$\alpha_{horiz}(Y_1, Y_2, X_1, X_2) = 180 - a$$

Где 
- $X_{1}, Y_{1}$ - координаты начала прямой
- $X_{2}, Y_{2}$ - координаты конца прямой
- $a -$ угол наклона прямой в горизонту 

**3. Длина отрезка проходящего через 2 точки**

$$l_{section}(Y_1, Y_2, X_1, X_2)=\sqrt{(X_2 - X_1)^2 + (Y_2 - Y_1)^2}$$

**4. Нахождение расстояния от точки до прямой**

$$
l_{arm}(Y_1, Y_2, X_1, X_2, x,y) = \frac{x-X_1}{X_2-X_1} = \frac{y-Y_1}{Y_2-Y_1}
$$

Где
- $x, y$ - координаты точки 

**5.Каноническое уравнение проходящее через 2 точки**

$$
d =\frac{(Y_2 - Y_1)\cdot x - (Y_2 - Y_1)\cdot X_1 - (X_2 - X_1)\cdot y + (X_2-X_1)\cdot Y_1}{\sqrt{({Y_2 - Y_1})^2 + ({X_2 - X_1})^2}}
$$ 

где: 
- $d -$ расстояние от точки до прямой 


## 2. Определение начальной точки и конечной точки для каждой стрелы:

Для расчета координат начала стрел, $XY_{start(i)}$ необходим следующий алгоритм : 

**1. Введем две составляющие $x_0$ и $w$.**

- Переменная $w$, которая расчитывается по формуле определения координат в повернутой системе координат со следующими входными данными: 

  - $l_{3,i}$ - горизонтальное смещение точки $A_i$ стрелы относительно точки $G_{i-1}$ (относительно ГСК для первой срелы) в соответствии с рисунком.
  - $l_{4,i}$ - вертикальное смещение точки $A_i$ стрелы относительно точки $G_{i-1}$ (относительно ГСК для первой срелы) в соответствии с рисунком.
  - $\alpha'_{boom_i}$ - необходимый угол
  - Вторая составляющая - $x_0$ 

![Alt text to image](/assets/algorithm/l3_l4.png)

**2. Рассчитаем $w$**

$$w_x(l_{4,i}, -l_{3,i}, \alpha'_{boom_i} = l_{4,i} \cdot \cos(\alpha'_{boom_i}) + l_{3,i} \cdot \sin(\alpha'_{boom_i})$$

$$w_y(l_{4,i}, -l_{3,i}, \alpha'_{boom_i}) = l_{4,i} \cdot \sin(\alpha'_{boom_i}) - l_{3,i} \cdot \cos(\alpha'_{boom_i})$$


$$
w =
\begin{bmatrix}
w_x \\
w_y
\end{bmatrix}
$$

**3. Определим $x_0$ для первой и следующих стрел**

- Для **первой стрелы** ($i = 1$) начальная точка в нашем случае совпадает с ГСК:
  Для первой стрелы угол принимается за 90.

$$x_0 =[0, 0]; \quad \alpha'_{boom_i}=90^\circ$$

- Для **последующих стрел** ($i > 1$) начальная точка совпадает с концом предыдущей стрелы, то есть с точкой $G_{i-1}$:

$$x_0 = G_{i-1}; \quad \alpha'_{boom_i}=\alpha_{boom_{(i-1)}}$$

**4. Определим координаты $XY_{start(i)}$**

$$XY_{start(i)} = x_0 + w$$

**5. Рассчитаем координаты $D_i$ и $G_i$ в ГСК и определим матрицу $Т$**

Для расчета коодинат $D_i$ и $G_i$ нам необходимы следующие величины 

  - $l_{1,i}$ - **вертикальное расстояние** от точки $D_i$ до точки $A_i$ (перпендикуляр от D до оси поворота стрелы) в соответсвии с рисунком
  - $l_{2,i}$ - **горизонтальное расстояние** от точки $D_i$ до точки $A_i$ (вдоль оси стрелы) в соответсвии с рисунком

![Alt text to image](/assets/algorithm/l1_l2.png)

- Точка **D** (начало стрелы):

$$
D_i = XY_{start(i)} + XY_x(-l_{(2,i)},\quad l_{(1,i)}, \quad\alpha_{boom(i)})
$$

- Точка **G** (конец стрелы):

$$
G_i = XY_{start(i)} + XY_x(L_{boom(i)} -l_{(2,i)},\quad l_{(1,i)}, \quad \alpha_{boom(i)})
$$

- Матрица **Т** - матрица, содержащая пары точек (D, G) для каждой стрелы.

$$
T =
\begin{bmatrix}
D_i  \\
G_i
\end{bmatrix}
$$

---
> Эти точки используются для построения трансформационной матрицы $T_i$, описывающей положение стрелы $i$ в пространстве, а также для определения координат всех объектов, расположенных на этой стреле.

## 3. Определение координаты точек блоков
Для определения кооординат точек блоков, нам неуобходимы будут: 
- $K_{lFx(i,j)}$ - признак, показывающий от какой точки брать координату: от конца или начала стрелы, где $i -$ номер стрелы, $j -$ номер блока. 
- $l_{F_x(i,j)}$ - перпендикулярное расстояние от блока до оси стрелы
- $l_{F_y(i,j)}$ - продольное расстояние (вдоль стрелы) от выбранной точки $K_{lFx}$ - (D или G) до проекции точки на ось стрелы 

![Alt text to image](/assets/algorithm/Flx_Fly.png)

Алгоритм следующий: 

1. Определение  $K_{lFx(i,j)}$
   
- Если $K_{lFx(i,j)} == "D"$ , то мы берем из массива T значения из **первой** строки для i-ой стрелы и j-блока, так как туда записывали $D_i$. Для упрощения **a** - индекс строки массива, для $"D"$ **a --> 1**

- Если $K_{lFx(i,j)} == "G"$ , то мы берем из массива T значения из **второй** строки для i-ой стрелы и j-блока, так как туда записывали $G_i$ Для упрощения **a** - индекс строки массива, для $"G"$ **a --> 2**

Данный параметр будет использоваться для телескопических стрел, для остальных - данный параметр не используется.
Привязка будет к концу стрелы, так как большиство блоков находятся на конце стрелы.


Далее считаем для каждого блока координаты по общей формул

$$
XY_{block(i,j)} = XY_x(l_{F_x(i,j)}, \quad l_{F_y(i,j)}, \quad \alpha_{boom(i)}) +  G_{i}
$$

$$
XY_{block(i,j)} =
\begin{bmatrix}
X_{block(i,j)} \\
Y_{block(i,j)}
\end{bmatrix}
$$

## 4. Алгоритм определения точек схода каната на блоках 

**1. Определение схемы схода каната** --> присваивание значений $k$ и $j$ в соответсвии с рисунком и таблицей ниже. 

![Alt text to image](/assets/algorithm/схема_схода_каната.jpg)

Существую 4 схемы схода каната, в соответсвие с рисунком необходимо определить к какому типу схему относится сход каната на i-том блоке. Далее по нему присваиваются значения $k$ и $j$ , как представлено ниже.

- **Схема 1 :** *k = -1, j = 1*
- **Схема 2 :** *k = 1, j = 1*
- **Схема 3 :** *k = 1, j = -1*
- **Схема 4 :** *k = -1, j = -1*

**2. Находим длину  отрезка между двумя точками**

Для нахождения расстояния между центрами блоков необходимо применить **формулу 3** из раздела *"Общие формулы"*

$$l_{block} = l_{section}(Y_1, Y_2, X_1, X_2) $$

**3. Находим угол между центром блока и горизонтом** 

**Формула 2** из раздела *"Общие формулы"*

$$\alpha_{block} = \alpha_{horiz}(Y_1, Y_2, X_1, X_2)$$

**4. Находим угол каната**

Расчитываем угол каната по формуле 

$$\alpha_{rope} = \alpha_{block} + j \cdot asin(\frac{0.5 \cdot (D_1 + k \cdot D_2)}{l_{block}})$$

Где 
- $D_1, D_2 -$ диаметры блоков 

**5. Находим координаты**
$$X_{1block} = X_1 + j \cdot 0.5 \cdot D_1 \cdot sin(\alpha_{rope}) $$

$$Y_{1block} = Y_1 + j \cdot 0.5 \cdot D_1 \cdot cos(\alpha_{rope}) $$

$$X_{2block} = X_2 - j \cdot k \cdot 0.5 \cdot D_2 \cdot sin(\alpha_{rope}) $$

$$Y_{2block} = Y_2 - j \cdot k \cdot 0.5 \cdot D_2 \cdot cos(\alpha_{rope}) $$

**6. Находим длину каната, заключенного между точками схода**
   
$$l_{rope} = l_{section}(Y_{2block}, Y_{1block}, X_{2block}, X_{1block})$$

## 5. Алгоритм учитывающий координаты блоков вне стрел

Для расчета координат блоков вне стрелы введем параметр $Feature_{block}$, который характеризует положение блока:

- *"{i} стрела"*
- *"Вне стрелы"*
- *"Подвеска"*

**Координаты блоков крюковой подвески**
- $if \quad Feature_{block} == {"Подвеска"}$ R

$$lF_x == NaN$$
**Координаты блоков внес стрел**
- $else if \quad Feature_{block} == {"Вне стрелы"}$

$$
XY_{block(i,j)} = XY_x(-l_{F_x(i,j)}, \quad l_{F_y(i,j)}, \quad {0}) +  XY_x(l_{4,1}, \quad l_{3,1}, \quad {90})
$$

**Координаты блоков на стрелах**

$$
XY_{block(i,j)} = XY_x(l_{F_x(i,j)}, \quad l_{F_y(i,j)}, \quad \alpha_{boom(i)}) +  G_{i}
$$


И далее все собирается в один массив $XY_{F_boom}$

![Alt text to image](/assets/algorithm/crane_with_0block.png)

## Реализация (Пример)

## Входные данные

| Переменная         | Тип / Формат           | Описание                                                       |
|--------------------|------------------------|-----------------------------------------------------------------|
| $L_{boom(i)}$       | float (мм)             | Длина i-ой стрелы стрелы                                          |                                  |
| $\alpha_i$      | float (°)              | Угол между стрелами                    |        |            |
| $n$       |                int |         Количество стрел |     
| $i$     | int                 | Номер стрелы: `1` — `main boom`, `2` — `knuckle boom`          |
|$l_{1, i}$|float(мм)|**Вертикальное расстояние** от точки $D_i$ до точки $A_i$ (перпендикуляр от D до оси поворота стрелы)|
|$l_{2, i}$|float(мм)|**Горизонтальное расстояние** от точки $D_i$ до точки $A_i$ (вдоль оси).|
|$l_{3,i}$|float(мм)|Горизонтальное смещение точки $A_i$ стрелы относительно точки $G_{i-1}$ (относительно ГСК для первой срелы) в соответствии с рисунком. |
|$l_{4,i}$|float(мм)|Вертикальное смещение точки $A_i$ стрелы относительно точки $G_{i-1}$ (относительно ГСК для первой срелы) в соответствии с рисунком. |
|$j$|int|Номер блока|
|$K_{lFx(i,j)}$|str|Признак, показывающий от какой точки брать координату: от конца или начала стрелы (пока не используется)|
|$l_{F_x(i,j)}$|float (мм)|Перпендикулярное расстояние от блока до оси стрелы| 
|$l_{F_y(i,j)}$|float (мм)|Продольное расстояние (вдоль стрелы) от выбранной точки $K_{lFx}$ - (D или G) до проекции точки на ось стрелы |
|$D_i$|float(mm)|Диаметр блока|
|$Scheme_i$|int|Номер схемы|
|$Feature_{block}$|str|Расположение блока(на стреле, вне стрелы, на подвеске)|


## Выходные данные

| Переменная     | Тип / Формат          | Описание                     |
| -----------    | --------------------- | ---------------------------- |
|$X_{block(i,j)}$|float(мм)              |Координата X i-го блока|
|$Y_{block(i,j)}$|float(мм)              |Координата Y i-го блока|


Исходные данные:
-

Пример реализации в коде `Python`
-

![Alt text to image](/assets/algorithm/python1.png)

```python
import matplotlib.pyplot as plt
import math
import logging 
import matplotlib.patches as patches

logging.basicConfig(level = logging.DEBUG, force = True)
# ---------------------------
# Исходные данные
# ---------------------------
#alpha = [0, 23.783]            # Углы в градусах как в расчете у Вани
alpha = [74, 128]               # Углы в градусах
L_boom = [11200, 7984]          # Длины стрел (мм)
l1 = [0, 0]                     # вертикальное смещение точки D
l2 = [0, 0]                     # горизонтальное смещение точки D
l3 = [0, 0]                     # вертикальное смещение начала стрелы
l4 = [10330, 0]                 # горизонтальное смещение начала стрелы
D = [844, 816.2, 816.2, 816.2, 816.2, 816.2, 0] # диаметры лебедки(1), блоков, подвески (последний)
schemes = [1, 1, 1, 2, 3, 1]       # схема схода каната на блоке 
Feature_block = [
    "Вне стрелы",   # Блок 1
    "1 Стрела",     # Блок 2
    "2 Стрела",     # Блок 3
    "2 Стрела",     # Блок 4
    "2 Стрела",     # Блок 5
    "2 Стрела",     # Блок 6
    "Подвеска"      # Блок 7
]

# Размеры расположения блоков на стрелах
# lFx = [308, -6551, -1120, 268, 140]  # мм 
# lFy = [1090, 1743, 1005, 895, 0]   # мм

lFx = [1830, 308, -6550, -1120, 268, 140, 0]  
lFy = [710, 1090, 1743, 1005, 895, 0, 0]  

#lFx = [308, 1435, -1121, 267, 136]  # мм как в расчете у Вани
#lFy = [1100, 1730, 973, 860, -35]   # мм как в расчете у Вани
#K_lFx = ["G", "D", "G", "G", "G"]   # привязка блока к D(начало стрелы) или G(конец стрелы)
boom_index = [1, 2, 2, 2, 2]        # к какой стреле относится блок (нумерация с 1)

# ---------------------------
# Вспомогательные функции
# ---------------------------

def XY_rotate(lx, ly, alpha):
    angle_rad = math.radians(alpha)
    x = lx * math.cos(angle_rad) - ly * math.sin(angle_rad)
    y = lx * math.sin(angle_rad) + ly * math.cos(angle_rad)
    return x, y

def alpha_horiz(Y1, Y2, X1, X2):
    """Угол наклона прямой к горизонту (в градусах)"""
    # Длина отрезка
    length = math.sqrt((X2 - X1)**2 + (Y2 - Y1)**2)
    if length == 0:
        return 0
    a = math.degrees(math.asin((Y1 - Y2) / length))
    if X1 <= X2:
        return a
    else:
        return 180 - a

def l_section(Y1, Y2, X1, X2):
    return math.sqrt((X2 - X1)**2 + (Y2 - Y1)**2)

def distance_point_to_line(Y1, Y2, X1, X2, x, y):
    """Расстояние от точки (x, y) до прямой, проходящей через (X1, Y1) и (X2, Y2)"""
    numerator = abs((Y2 - Y1) * x - (Y2 - Y1) * X1 - (X2 - X1) * y + (X2 - X1) * Y1)
    denominator = math.sqrt((Y2 - Y1)**2 + (X2 - X1)**2)
    if denominator == 0:
        return 0
    return numerator / denominator


def rope_parameters(X1, Y1, X2, Y2, D1, D2, k, j):
    l_block = l_section(Y1, Y2, X1, X2)
    alpha_block = alpha_horiz(Y1, Y2, X1, X2)
    alpha_rope = alpha_block + j * math.degrees(math.asin(0.5 * (D1 + k * D2) / l_block))
    X1_block = X1 + j * 0.5 * D1 * math.sin(math.radians(alpha_rope))
    Y1_block = Y1 + j * 0.5 * D1 * math.cos(math.radians(alpha_rope))
    X2_block = X2 - j * k * 0.5 * D2 * math.sin(math.radians(alpha_rope))
    Y2_block = Y2 - j * k * 0.5 * D2 * math.cos(math.radians(alpha_rope))
    
    l_rope = l_section(Y2_block, Y1_block, X2_block, X1_block)
    return {
        "l_block": l_block,
        "alpha_block": alpha_block,
        "alpha_rope": alpha_rope,
        "X1_block": X1_block,
        "Y1_block": Y1_block,
        "X2_block": X2_block,
        "Y2_block": Y2_block,
        "l_rope": l_rope
    }


# ---------------------------
# 1. Число стрел
# ---------------------------
n = len(alpha)

# ---------------------------
# 2. Угол наклона к горизонту каждой стрелы (alpha_boom)
# ---------------------------
alpha_boom = []
for i in range(1, n + 1):
    alpha_boom.append(sum(alpha[:i]) - (i - 1) * 180)

# ---------------------------
# 3. Матрица T (D и G для каждой стрелы)
# ---------------------------
T = []
for i in range(1, n + 1):
    # Начало стрелы
    if i == 1:
        x0, y0 = 0, 0
        alpha_prime = 90
    else:
        x0, y0 = T[i - 2][1] 
        alpha_prime = alpha_boom[i - 2]

    wx, wy = XY_rotate(l4[i-1], l3[i-1], alpha_prime)
    XY_start = (x0 + wx, y0 + wy)

    # Точка D
    Dx, Dy = XY_rotate(-l2[i-1], l1[i-1], alpha_boom[i-1])
    D_point = (XY_start[0] + Dx, XY_start[1] + Dy)

    # Точка G
    Gx, Gy = XY_rotate(L_boom[i-1] - l2[i-1], l1[i-1], alpha_boom[i-1])
    G_point = (XY_start[0] + Gx, XY_start[1] + Gy)

    T.append((D_point, G_point))

# ---------------------------
# 4. Координаты блоков XY_block
# ---------------------------
# XY_block = []
# for idx in range(len(lFx)):
#     boom_i = boom_index[idx] - 1
#     base_point = T[boom_i][1]
#     dx, dy = XY_rotate(lFx[idx], lFy[idx], alpha_boom[boom_i])
#     XY_block.append((base_point[0] + dx, base_point[1] + dy))

XY_block = []
for idx in range(len(Feature_block)):
    feature = Feature_block[idx]

    if feature == "Вне стрелы":
        # Формула из алгоритма:
        dx1, dy1 = XY_rotate(-lFx[idx], lFy[idx], 0)
        dx2, dy2 = XY_rotate(l4[0], l3[0], 90)  # от первой стрелы
        x = dx1 + dx2
        y = dy1 + dy2
        XY_block.append((x, y))

    elif feature.endswith("Стрела"):
        # Определяем номер стрелы
        boom_num = int(feature.split()[0]) - 1
        base_point = T[boom_num][1]  # точка G
        dx, dy = XY_rotate(lFx[idx], lFy[idx], alpha_boom[boom_num])
        XY_block.append((base_point[0] + dx, base_point[1] + dy))

    elif feature == "Подвеска":
        XY_block.append((float('nan'), float('nan')))

    else:
        raise ValueError(f"Неизвестный тип блока: {feature}")


# XY_block = []
# for i in range(len(lFx)):
#     base_point = T[boom_i][0]
#     boom_i = boom_index[idx] - 1
#     if K_lFx[idx] == "D":
#         base_point = T[boom_i][0]
#     elif K_lFx[idx] == "G":
#         base_point = T[boom_i][1]
#     else:
#         raise ValueError("Некорректное значение K_lFx")

#     dx, dy = XY_rotate(lFx[idx], lFy[idx], alpha_boom[boom_i])
#     XY_block.append((base_point[0] + dx, base_point[1] + dy))
    

# ---------------------------
# 5. Расчёт параметров каната
# ---------------------------
rope_data = []
for i in range(len(XY_block) - 1):
    X1, Y1 = XY_block[i]
    X2, Y2 = XY_block[i + 1]
    D1 = D[i]
    D2 = D[i + 1]
    scheme = schemes[i]

    if scheme == 1: k, j = -1, 1
    elif scheme == 2: k, j = 1, 1
    elif scheme == 3: k, j = 1, -1
    elif scheme == 4: k, j = -1, -1
    else: raise ValueError(f"Некорректная схема: {scheme}")

    params = rope_parameters(X1, Y1, X2, Y2, D1, D2, k, j)
    params["block_pair"] = (i + 1, i + 2)
    params["scheme"] = scheme
    rope_data.append(params)

# ---------------------------
# Логи
# ---------------------------
logging.debug(f"Число стрел: {n}")
logging.debug(f"alpha_boom: {[round(a, 3) for a in alpha_boom]}")
for idx, (D_pt, G_pt) in enumerate(T, start=1):
    logging.debug(f"Стрела {idx}: D={D_pt}, G={G_pt}")
for i, coord in enumerate(XY_block, start=1):
    logging.debug(f"Блок {i}: {coord}")
for r in rope_data:
    logging.debug(f"Блоки {r['block_pair']} | Схема {r['scheme']} | "
                  f"L_block={r['l_block']:.2f} | Alpha_rope={r['alpha_rope']:.2f}° | "
                  f"L_rope={r['l_rope']:.2f}")

# ---------------------------
# Построение графика
# ---------------------------
plt.figure(figsize=(10, 8))
plt.title("Схема расположения стрел и блоков")
plt.xlabel("X координата (мм)")
plt.ylabel("Y координата (мм)")
plt.grid(True)
plt.axis('equal')

# Стрелы
colors = ['green', 'blue']
for i, (D_pt, G_pt) in enumerate(T):
    plt.plot([D_pt[0], G_pt[0]], [D_pt[1], G_pt[1]], color=colors[i], linewidth=1.5)
    plt.scatter([D_pt[0], G_pt[0]], [D_pt[1], G_pt[1]], color=colors[i], s=20, marker='s')

# Блоки
for i, (x, y) in enumerate(XY_block):
    if math.isnan(x) or math.isnan(y):
        continue
    radius = D[i] / 2
    circle = patches.Circle((x, y), radius, fill=False, color='deepskyblue', linewidth=1)
    plt.gca().add_patch(circle)
    plt.text(x + radius, y + radius, f'Блок {i+1}', fontsize=8, color='black')

# Канаты
for r in rope_data:
    plt.plot([r["X1_block"], r["X2_block"]], [r["Y1_block"], r["Y2_block"]],
             color='blue', linestyle='--')
    plt.scatter([r["X1_block"], r["X2_block"]], [r["Y1_block"], r["Y2_block"]],
                color='orange', s=15)

plt.legend()
plt.show()
```
